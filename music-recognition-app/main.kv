#: import ew kivy.uix.effectwidget
#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import FadeTransition kivy.uix.screenmanager.FadeTransition
#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import NoTransition kivy.uix.screenmanager.NoTransition
<MainScreen>
    screen_manager: screen_manager
    nav_drawer: nav_drawer
    MDNavigationLayout:
        ScreenManager:
            transition: NoTransition()
            id: screen_manager
            WelcomeScreen:
                name: "welcome-screen"
            Sounds:
                name: "first-screen"
            MusicScreen:
                name: "second-screen"
            SongDetailsScreen:
                name: "third-screen"
            ArtistDetailsScreen:
                name: "fourth-screen"
        MDNavigationDrawer:
            id: nav_drawer

            home_btn: home_btn
            mp_btn: mp_btn
            details_btn: details_btn

            opening_transition: 'out_bounce'
            opening_time: 1
            closing_transition: 'in_out_elastic'
            closing_time: 1
            close_on_click: True
            status:'closed'
            state: 'close'
            BoxLayout:
                orientation: 'vertical'
                spacing: '8dp'
                padding: '8dp'
                Image:
                    source: 'images/music.png'
                    allow_stretch: False
                    anim_delay: 0.3
                MDRectangleFlatIconButton:
                    id: home_btn
                    icon: 'home'
                    size_hint_x: 1
                    text: "Home"
                    text_color: 1,1,0,1
                    disabled: False
                    disabled_outline_color: 1,1,0,1
                    on_release:
                        root.nav_drawer.set_state('close')

                MDRectangleFlatIconButton:
                    id: mp_btn
                    icon: 'music'
                    size_hint_x: 1
                    text: "Music Player"
                    text_color: (106/255, 90/255, 205/255, 1)
                    disabled: True
                    disabled_outline_color: 1,1,0,1
                    on_press:
                        root.navigate_to('second-screen')

                MDRectangleFlatIconButton:
                    id: details_btn
                    icon: 'format-align-justify'
                    size_hint_x: 1
                    text: "Details"
                    text_color: (106/255, 90/255, 205/255, 1)
                    disabled: True
                    background_disabled_vertical: 1,1,0,1
                    on_release:
                        root.navigate_to('third-screen')
                Widget:


#<Content>:
#    ScrollView:
#        MDList:
#            OneLineListItem:
#                text: "Home"
#            OneLineListItem:
#                text: "Music Player"
#            OneLineListItem:
#                text: "Song Details"

<Sounds>:
    id: first_screen
#    nav_drawer: app.main_screen.nav_drawer
    img: img
#    home_btn: home_btn
#    mp_btn: nav_drawer.mp_btn
#    details_btn: nav_drawer.details_btn

#    BoxLayout:
#        orientation: "vertical"
#        #size: root.width, root.height


    FitImage:
        id: img
        source: 'images/white.jpg'
        allow_stretch: False
        anim_delay: 0.7

    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height
        Image:
            id: img
            source: 'images/mic2.gif'
            allow_stretch: False
            anim_delay: 1

    MDToolbar:
        pos_hint: {"top":1}
        title: ''
        left_action_items: [["menu", lambda x: root.open_nav_drawer(app)]]
        #right_action_items: [["clock", lambda x: app.callback()]]
        font_name: 'VastShadow'
        elevation:10

    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height
        MDLabel:
            id: my_label
            text: 'Turn ON your mic for listening ...'
            source: 'images/loader.gif'
            halign: 'center'
            font_style: 'H5'
            font_name: 'BadScript'
            theme_text_color: 'Custom'
            text_color: (0, 0, 0, 1)



#        MDRectangleFlatButton:
#            text: "Press"
#            pos_hint: {'center_x': 0.5, 'center_y':0.5}
#            on_press: root.manager.current = 'second-screen'



        MDBottomAppBar:
            MDToolbar:
                id: my_md
                #left_action_items: [["coffee", lambda x: app.navigation_draw()]]

                mode: 'center'
                type: 'bottom'
                icon: 'microphone-off'
                on_action_button: root.test()
                #on_action_button: root.release()

<MusicScreen>:
    song_name: song_name
    artist_name: artist_name
    img: img
    cov_img: cov_img
    rot_img: rot_img
    play_pause: play_pause
    progr: progress
    EffectWidget:
        effects: [ew.VerticalBlurEffect(size=10), ew.HorizontalBlurEffect(size=10)]
        FitImage:
            id: cov_img
            source: 'images/test.jpg'
            allow_stretch: True
            anim_delay: 0.05
            #anim_reset: True
    Image:
        id: img
        source: 'images/transparent.png'
        allow_stretch: False
        anim_delay: 0.1
        #anim_reset: True
    MDBoxLayout:
        orientation: 'vertical'
        padding: ['10dp', '30dp', '10dp', '50dp']
        SongCover:
            id: sc
            screen_mng: root.manager
            play_pause: play_pause
            progr: progress
            song_name: song_name
            artist_name: artist_name
            img: img
            rot_img: rot_img
            size: (250, 250)
            size_hint: None, None
            pos_hint: {'center_x': .5}
            RotatingImage:
                id: rot_img
                angle: sc.angle
                source: 'images/test.jpg'
                #allow_stretch: True
                #anim_delay: 0
                radius: [250, ]
        Widget:
            size_hint: None, None
            height: '25dp'
        Label:
            id: song_name
            text: 'Song Name'
            bold: True
            font_size: '30sp'
            font_name: 'Flavors'
            text_color: (1, 0, 0, 1)
            size_hint_y: None
            height: self.texture_size[1]
        Label:
            id: artist_name
            text: 'Artist Name'
            bold: True
            font_size: '18sp'
            size_hint_y: None
            font_name: 'BadScript'
            height: self.texture_size[1]

        MDBoxLayout:
            orientation: 'vertical'
            Slider:
                id: progress
                color: [.7, 0, 0, 1]
                min: 0
                max: 100
                value: 0
                background_width: '20dp'
                cursor_image: ''
                cursor_size: ('10dp', '10dp')
                value_track_color: [1,0,0,1]
                value_track: True

            MDBoxLayout:
                AnchorLayout:
                    size_hint_y: 1
                    MyIcon:
                        icon: 'arrow-left'
                        on_press: root.manager.current = 'first-screen'
                AnchorLayout:
                    size_hint_y: 1
                    MyIcon:
                        id: play_pause
                        icon: 'play-outline'
                        on_press: sc.play_music(progress)
                AnchorLayout:
                    size_hint_y: 1
                    MyIcon:
                        icon: 'stop'
                        on_press: sc.stop_music(progress)
                AnchorLayout:
                    size_hint_y: 1
                    MyIcon:
                        icon: 'format-align-justify'
                        on_press: root.manager.current = 'third-screen'





<SongDetailsScreen>:
    id: det_screen
    tabs: tabs
    year: year
    duration: duration
    album: album
    energy: energy
    danceability: danceability
    popularity: popularity
    song: song
    ds:ds
    #song_miniplayer: song_miniplayer
    #progress_details: progress_details
    my_lyrics: my_lyrics
    ringtone_btn: ringtone_btn
    pdf_btn: pdf_btn
    downloader: downloader
    det_img: det_img
    #play_details: play_details
    EffectWidget:
        effects: [ew.VerticalBlurEffect(size=10), ew.HorizontalBlurEffect(size=10)]
        FitImage:
            id: det_img
            source: 'images/blue-cover.jpg'
            allow_stretch: True
            anim_delay: 0.05
            #anim_reset: True



    MDBoxLayout:
        orientation: "vertical"
        MDBoxLayout:
            size_hint_y: .15
            padding: dp(15)
            MDBoxLayout:
                orientation: "horizontal"
                MDLabel:
                    id: song
                    text: "Artist - Song Name"
                    font_style: "H6"


                MyIcon:
                    icon: 'information'
                    user_font_size: '40dp'
                    on_press: root.manager.current = 'fourth-screen'
        MDTabs:
            id: tabs
            Tab:
                title: "Details"
                DetailsScreen:
                    id: ds
                    screen_mng: root.manager
                    year: year
                    duration: duration
                    album: album
                    energy: energy
                    danceability: danceability
                    popularity: popularity
                    #progress_details: progress_details
                    #play_details: play_details
                    #song_miniplayer: song_miniplayer
                    MDBoxLayout:
                        orientation: "vertical"
                        MDGridLayout:
                            size_hint_y: .75
                            cols: 2
                            padding: dp(15)
                            spacing: dp(15)
                            text_color: (1, 1, 1, 1)
                            ElementCard:
                                id: year
                                image: "images/calendar-icon.png"
                                text: 'Release Date'
                                subtext: '2022'
                            ElementCard:
                                id: duration
                                image: "images/duration.png"
                                text: 'Duration'
                                subtext: '2022'
                            ElementCard:
                                id: album
                                image: "images/album.png"
                                text: 'Album'
                                subtext: '2022'
                            ElementCard:
                                id: energy
                                image: "images/Energy.png"
                                text: 'Energy'
                                subtext: '2022'
                            ElementCard:
                                id: danceability
                                image: "images/Danceability.jpg"
                                text: 'Danceability'
                                subtext: '2022'
                            ElementCard:
                                id: popularity
                                image: "images/Popularity.png"
                                text: 'Top Ranking'
                                subtext: '2022'
            Tab:
                title: "Lyrics"
                DetailsScreen:
                    my_lyrics: my_lyrics
                    #progr_details: progress_details
                    ScrollView:
                        MDLabel:
                            size_hint_y: None
                            height: self.texture_size[1]
                            id: my_lyrics
                            text: 'Lyrics'
                            halign: 'center'
                            #font_style: 'H6'
                            text_size: self.width, None

                            theme_text_color: 'Custom'
                            #text_color: (255/255.0, 0/255.0, 0/255.0, 1)
                            text_color: (106/255, 90/255, 205/255, 1)

            Tab:
                title: "Download"
                DetailsScreen:
                    id: downloader
                    ringtone_btn: ringtone_btn
                    pdf_btn: pdf_btn
                    screen_mng: root.manager
                    song: song
                    MDFloatLayout:
                        orientation: 'vertical'
                        MDRectangleFlatButton:
                            id: pdf_btn
                            text: "Lyrics PDF"
                            pos_hint: {"center_x": .5, "center_y": .7}
                            on_press: downloader.download_pdf()
                            disabled: False
                        MDRectangleFlatButton:
                            id: ringtone_btn
                            text: "Ringtone"
                            pos_hint: {"center_x": .5, "center_y": .6}
                            on_press: downloader.download_mp3()
                            disabled: False

#                        MDRectangleFlatButton:
#                            text: "WAV Ringtone"
#                            pos_hint: {"center_x": .5, "center_y": .5}
#                            on_press: downloader.download_wav()


    BoxLayout:
        canvas:
            Color:
                rgba:(*get_color_from_hex('#3498DB')[0:-1], 0.5)
            Rectangle:
                pos: self.pos
                size: self.size

        orientation: 'vertical'
        size_hint_y: None
        height: '40dp'
        Widget:
            size_hint_y: None
            height: '7dp'
        MDBoxLayout:
            AnchorLayout:
                orientation: 'vertical'

                MyIcon:
                    icon: 'home'
                    icon_size: 70
                    on_release:
                        root.manager.current = 'first-screen'

            AnchorLayout:
                orientation: 'vertical'

                MyIcon:
                    icon: 'music'
                    icon_size: 70
                    on_release:
                        root.manager.current = 'second-screen'





#            Tab:
#                title: "Home"


<ArtistDetailsScreen>:
    artist_profile_img: artist_profile_img
    song1: song1
    song2: song2
    song3: song3
    song4: song4
    song5: song5
    icon1: icon1
    icon2: icon2
    icon3: icon3
    icon4: icon4
    icon5: icon5
    singer_name: singer_name
    artist_musical_genres: artist_musical_genres
    dim: dim
    album1: album1
    album2: album2
    album3: album3
    album4: album4
    album5: album5
    icon_album1: icon_album1
    icon_album2: icon_album2
    icon_album3: icon_album3
    icon_album4: icon_album4
    icon_album5: icon_album5
    followers: followers
    AKSilverAppbar:
        singer_name: singer_name
        artist_profile_img: artist_profile_img
        max_height: '250dp'
        title:'Artist Info'
        left_action_items: [["arrow-left", lambda x: root.change_screen()]]
        #right_action_items: [["magnify", lambda x: None]]
        pin_top: True
        hide_toolbar: True
        radius: dp(20)
        toolbar_bg: app.theme_cls.primary_color
        AKSilverAppbarHeader:
            MDScreen:
                #artist_profile_img: artist_profile_img
                md_bg_color: app.theme_cls.primary_color
                MDBoxLayout:
                    adaptive_height:True
                    orientation: "vertical"
                    pos_hint:{'center_x':.5,'center_y':.5}
                    spacing:"20dp"
                    MDBoxLayout:
                        size_hint:None,None
                        size:'85dp','85dp'
                        pos_hint:{'center_x':.5,'center_y':.5}
                        FitImage:
                            id: artist_profile_img
                            source: "/images/white.png"
                            allow_stretch: True
                            keep_ratio: False
                            radius: [40, 40, 40, 40, ]

                    MDLabel:
                        id: singer_name
                        text:'Singer'
                        halign:"center"
                        font_style: 'H5'
                        adaptive_height:True
        AKSilverAppbarContent:
            padding:'20dp'
            spacing:'20dp'
            id: content
            size_hint_y: None
            height: self.minimum_height
            orientation: "vertical"
            MDLabel:
                text:"Followers on Spotify"
                font_style: 'H6'
                adaptive_height:True

            MDCard:
                size_hint_y:None
                height:"80dp"
                orientation:"vertical"
                radius:20
                padding:"10dp"
                OneLineIconListItem:
                    id: followers
                    text: "#1"
                    divider:None
                    IconLeftWidget:
                        icon: "spotify"
            MDLabel:
                text:"Top 5 Popular on Spotify"
                font_style: 'H6'
                adaptive_height:True

            MDCard:
                size_hint_y:None
                height:"380dp"
                orientation:"vertical"
                radius:20
                padding:"10dp"
                TwoLineIconListItem:
                    id: song1
                    icon1: icon1
                    text: "#1"
                    secondary_text: "#1"
                    ImageLeftWidget:
                        id: icon1
                        source: "images/test.jpg"
                TwoLineIconListItem:
                    id: song2
                    text: "#2"
                    secondary_text: "#2"
                    ImageLeftWidget:
                        id: icon2
                        source: "images/test.jpg"
                TwoLineIconListItem:
                    id: song3
                    text: "#3"
                    secondary_text: "#3"
                    ImageLeftWidget:
                        id: icon3
                        source: "images/test.jpg"
                TwoLineIconListItem:
                    id: song4
                    text: "#4"
                    secondary_text: "#4"
                    ImageLeftWidget:
                        id: icon4
                        source: "images/test.jpg"
                TwoLineIconListItem:
                    id: song5
                    text: "#5"
                    secondary_text: "#5"
                    divider:None
                    ImageLeftWidget:
                        id: icon5
                        source: "images/test.jpg"
            MDLabel:
                text:"Music genres"
                font_style: 'H6'
                adaptive_height:True
            MDCard:
                id: dim
                size_hint_y:None
                height:"80dp"
                orientation:"vertical"
                radius:20
                padding:"10dp"
                MDLabel:
                    id: artist_musical_genres
                    text:"Music genres\n dafdsfda\n dsffe\n sdf"
                    font_style: 'Subtitle1'
                    halign:"center"
                    #adaptive_height:True

            MDLabel:
                text:"Albums | Singles"
                font_style: 'H6'
                adaptive_height:True
            MDCard:
                size_hint_y:None
                height:"450dp"
                orientation:"vertical"
                radius:20
                padding:"10dp"
                ThreeLineIconListItem:
                    id: album1
                    text: "Lock Screen"
                    secondary_text: "Screen lock type"
                    tertiary_text: "fit more text than usual"
                    ImageLeftWidget:
                        id: icon_album1
                        icon: "images/test.jpg"
                ThreeLineIconListItem:
                    id: album2
                    text: "Sounds and Vibration"
                    secondary_text: "Sound mode . Ringtone"
                    tertiary_text: "fit more text than usual"
                    ImageLeftWidget:
                        id: icon_album2
                        icon: "images/test.jpg"
                ThreeLineIconListItem:
                    id: album3
                    text: "Calls"
                    secondary_text: "Calls . Contacts"
                    tertiary_text: "fit more text than usual"
                    ImageLeftWidget:
                        id: icon_album3
                        icon: "images/test.jpg"

                ThreeLineIconListItem:
                    id: album4
                    text: "Storage"
                    secondary_text: "Storage . Memory"
                    tertiary_text: "fit more text than usual"
                    ImageLeftWidget:
                        id: icon_album4
                        icon: "images/test.jpg"
                ThreeLineIconListItem:
                    id: album5
                    text: "Battery"
                    secondary_text: "Device Protection"
                    tertiary_text: "fit more text than usual"
                    divider:None
                    ImageLeftWidget:
                        id: icon_album5
                        icon: "images/test.jpg"

            MDLabel:
                text:"Theme"
                adaptive_height:True
            MDCard:
                size_hint_y:None
                height:"100dp"
                orientation:"vertical"
                radius:20
                padding:"10dp"
                TwoLineAvatarIconListItem:
                    text: "Dark Theme"
                    secondary_text: "switch between dark and light themes"
                    divider:None

                    IconLeftWidget:
                        icon: "images/dark-mode.png"
                    IconRightWidget:
                        icon: "checkbox-marked" if app.theme_cls.theme_style == "Dark" else "checkbox-blank-outline"
                        on_release:app.theme_cls.theme_style = "Light" if app.theme_cls.theme_style == "Dark" else 'Dark'
                        theme_text_color:'Custom'
                        text_color:app.theme_cls.primary_color


#    FloatLayout:
#        size_hint_y: None
#        height: '50dp'
#        AnchorLayout:
#            padding: ('5dp', '5dp', '5dp', '5dp')
#            size_hint_y: None
#            size: '70dp','60dp'
#            pos: (0,0)
#            BoxLayout:
#                orientation: 'vertical'
#                BoxLayout:
#                    canvas:
#                        Color:
#                            rgba:(*get_color_from_hex('#3f3f3f')[0:-1], 0.9)
#                        RoundedRectangle:
#                            pos: self.pos
#                            size: self.size
#                            radius: [dp(5), dp(5), dp(5), dp(5)]
#                    BoxLayout:
#                        size_hint_x: None
#                        width: '90dp'
#                        RoundedImage:
#                            source: 'images/2.jpg'
#                    Label:
#                        id: song_miniplayer
#                        text: '[b]Artist[/b]\nSong Name'
##                        Label:
##                            text: 'Song Name'
#                        markup: True
#                        size_hint_x: None
#                        width: '70dp'
#
#                    Widget:
#                    MDBoxLayout:
#                        AnchorLayout:
#                            MyIcon:
#                                id: play_details
#                                icon: 'play-outline'
#                                on_press: ds.play_music_from_details_screen(progress_details)
#                        AnchorLayout:
#                            MyIcon:
#                                icon: 'music'
#                                on_press: root.manager.current = 'second-screen'
#                        AnchorLayout:
#                            MyIcon:
#                                icon: 'close'
#
#                    Widget:
#                MDBoxLayout:
#                    Slider:
#                        id: progress_details
#                        color: [.7, 0, 0, 1]
#                        min: 0
#                        max: 100
#                        value: 0
#                        background_width: '20dp'
#                        cursor_image: ''
#                        cursor_size: ('10dp', '10dp')
#                        value_track_color: [1,0,0,1]
#                        value_track: True


<WelcomeScreen>:
    # Set sc screen name
#    name: "SplashScreen"
#    prog_bar: progress_bar

    # Start the progress bar animation when the screen is active
    MDBoxLayout:
        # Add float layout
        MDFloatLayout:
            # Add Gif image
            Image:
                source:'images/welcome-screen.gif'
                allow_stretch: True
                anim_delay: 0.1
                # anim_loop: 1
                anim_reset: True

            # Add box layout
            BoxLayout:
                # Set box position
                pos_hint:{'center_y':.3, 'center_x':.5}
                padding: "10dp"
                # set width to 70%
                size_hint_x: .7

                # Add progress bar
                MDProgressBar:
                    # Set progress id
                    id: progress_bar
                    # Set orientation
                    orientation: "horizontal"
                    # Set progress type
                    type: "indeterminate"
                    # Progress duration
                    running_duration: 1
                    # Catching duration
                    catching_duration: 1


#    on_enter: self.ids.progress_bar.start()
#    MDBoxLayout:
#        MDFloatLayout:
#            # Add Gif image
#            Image:
#                source:'images/welcome-screen.gif'
#                allow_stretch: True
#                anim_delay: 0.11
#                # anim_loop: 1
#                anim_reset: True
#
#            # Add box layout
#            MDProgressBar:
#                id: progress_bar
#                value: 0
#                size_hint: .8, None
#                pos_hint: {"center_x": .5, "center_y": .3}




<Tab>:
    MDLabel:
        id: label



<ElementCard@MDCard>:
    md_bg_color: 255/255,255/255,255/255,1
    size_hint_y: None
    padding: dp(15)
    #spacing: dp(15)
    radius: dp(15)
    image: ''
    text: ""
    subtext: ''
    height: dp(125)
    orientation: 'vertical'
    Image:
        source: root.image
        size_hint_y: 1
    MDBoxLayout:
        orientation: 'vertical'
        MDLabel:
            halign: "center"
            text: root.text
            text_color: (1, 1, 1, 1)
        MDLabel:
            halign: "center"
            font_style: "Caption"
            text: root.subtext
            text_color: (1, 1, 1, 1)


<MyIcon@MDIconButton>:
    color: [.7, 0, 0, 1]
    size_hint: None, None
    user_font_size: '20sp'
    theme_text_color: 'Custom'
    size: ('20dp', '20dp')
    text_color: [1,1,1,1]


<RotatingImage@FitImage>:
    angle: 0
    canvas.before:
        PushMatrix
        Rotate:
            angle: root.angle
            origin: self.center
    canvas.after:
        PopMatrix

<Icon@AnchorLayout>:
    anchor_y: 'center'
    anchor_x: 'center'
    img:''
    icon_size: '30dp', '30dp'
    color:[1, 1, 1, 1]
    BoxLayout:
        padding: ('5dp', '5dp', '5dp', '5dp')
        size_hint:None, None
        size:root.icon_size
        Image:
            source:root.img
            allow_stretch:True
            keep_ratio:False
            mipmap:True
            color:root.color

<RoundedImage>:
    source: ''
    texture: None
    canvas:
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(5), 0, 0, dp(5)]
            texture: root.texture
    size_hint_x: None
    width: '70dp'

